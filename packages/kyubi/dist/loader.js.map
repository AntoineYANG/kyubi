{"version":3,"sources":["../src/loader.ts"],"sourcesContent":["/*\r\n * @Author: Kyusho \r\n * @Date: 2024-02-14 22:26:33 \r\n * @Last Modified by: Kyusho\r\n * @Last Modified time: 2024-02-15 00:21:33\r\n */\r\n\r\nimport type { LoaderContext } from \"webpack\";\r\n\r\nimport type { IKyubiConfig } from \"./utils/get-kyubi-config\";\r\n\r\n\r\ninterface ILoaderContext {\r\n  config: IKyubiConfig;\r\n}\r\n\r\ninterface ILoader {\r\n  (this: LoaderContext<ILoaderContext>, source: string): void;\r\n}\r\n\r\ntype CreateProcessor = typeof import(\"@mdx-js/mdx\").createProcessor;\r\n\r\nlet createProcessor: CreateProcessor | null = null;\r\n\r\nconst makeProcessor = async (): Promise<CreateProcessor> => {\r\n  if (createProcessor) {\r\n    return createProcessor;\r\n  }\r\n  const mdx = await import(\"@mdx-js/mdx\");\r\n  createProcessor = mdx.createProcessor;\r\n  return createProcessor;\r\n};\r\n\r\nconst loader: ILoader = function (this, source) {\r\n  const { resourcePath } = this;\r\n  const { config } = this.getOptions();\r\n  const callback = this.async();\r\n  makeProcessor().then(\r\n    processor => processor({\r\n      jsx: false,\r\n      format: \"mdx\",\r\n      outputFormat: \"program\",\r\n      // providerImportSource\r\n      // remarkPlugins\r\n      // rehypePlugins\r\n    }).process({\r\n      pathname: resourcePath,\r\n      value: source,\r\n    })\r\n  ).then(res => {\r\n    console.log([res]);\r\n    const data = `// Path: ${resourcePath}\r\n${`${res}`.replaceAll(/^/gm, '  ')}\r\n`;\r\n    callback(null, data);\r\n  }).catch((err: any) => {\r\n    callback(err);\r\n  });\r\n};\r\n\r\n\r\nexport default loader;\r\n"],"mappings":"0jBAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAsBA,IAAII,EAA0C,KAExCC,EAAgB,SAChBD,IAIJA,GADY,KAAM,QAAO,aAAa,GAChB,gBACfA,GAGHE,EAAkB,SAAgBC,EAAQ,CAC9C,GAAM,CAAE,aAAAC,CAAa,EAAI,KACnB,CAAE,OAAAC,CAAO,EAAI,KAAK,WAAW,EAC7BC,EAAW,KAAK,MAAM,EAC5BL,EAAc,EAAE,KACdM,GAAaA,EAAU,CACrB,IAAK,GACL,OAAQ,MACR,aAAc,SAIhB,CAAC,EAAE,QAAQ,CACT,SAAUH,EACV,MAAOD,CACT,CAAC,CACH,EAAE,KAAKK,GAAO,CACZ,QAAQ,IAAI,CAACA,CAAG,CAAC,EACjB,IAAMC,EAAO,YAAYL,CAAY;AAAA,EACvC,GAAGI,CAAG,GAAG,WAAW,MAAO,IAAI,CAAC;AAAA,EAE9BF,EAAS,KAAMG,CAAI,CACrB,CAAC,EAAE,MAAOC,GAAa,CACrBJ,EAASI,CAAG,CACd,CAAC,CACH,EAGOZ,EAAQI","names":["loader_exports","__export","loader_default","__toCommonJS","createProcessor","makeProcessor","loader","source","resourcePath","config","callback","processor","res","data","err"]}